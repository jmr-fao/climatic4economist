{
  "hash": "ca031ad2b43a81c8529c79b08c719344",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: | \n     ![](images/Climat4Economist_Symbol_6.png){width=1in} \n     \n     Extract Spatial Variable with Climat4Economist\nsubtitle: Tutorial on how to extract spatial raster values based on survey coordinated loaction and survey administrative divisions using the Climat4Economist package\nexecute:\n  eval: true\nbrand:\n  logo: images/Climat4Economist_Symbol_6.png\n---\n\n\n\n\n## Introduction\nThis tutorial show how too extract spatial control variables based on surveys locations. The survey refers to Ethipia 2019 and comes from the [The World Bank Living Standards Measurement Study (LSMS)](https://www.worldbank.org/en/programs/lsms).\n\n### Is this guide for me?\n\nThis guide provides a step-by-step approach to extract raster data based on survey locations. The target audience includes economists who may have experience with statistical software (e.g. STATA) but are less familiar with spatial data processing in R.\n\nThe document is not meant to be a course on R or on how the functions work. It is just a practice example on how to extract raster data based on coordinate location. This is done by using specific functions that wrap up as many steps as possible to ensure it is easier for the user to follow.\n\n### What do I need before starting?\n\nThe following R packages are necessary: `terra`, `tidyverse`, `haven`, `purrr` and `climatic4economist`. To install the above package you can use `install.packages(\"name_of_package\")`, don't forget the `\"`.\n\nThe latter package, `climatic4economist` is not available on the web and it need to be installed from a local file. You can do it with `devtools::install_local(\"climatic4economist\")`\n\nIf you are not familiar with R check the [appendix] for understanding some coding style used in this tutorial.\n\n<br><br>\n\n## Take home messages\n\n* When working with multiple spatial data:\n  \n  1. remember to control the Coordinate Reference System of all dataset\n  2. plot the data to check everything is going well\n  \n* based on the typology of data we use different function\n  \n  - reading\n    * for `dta` use `haven::read_dta() or` and `haven::_write_dta()`\n    * for spatial vectors use `terra::vect()` or `read_adm_div()` for administrative divisions in specific country and level.\n    * for spatial raster use `terra::rast()`\n    \n  - extraction\n    \n    * spatial points, use `extract_by_coord()`\n    * spatial polygons, use `extract_by_poly()`\n    * cells within polygons, use `extract_cell_by_poly()`\n    \n* When working with raster data\n\n  1. check the unit of measure\n  2. if it is a time series check also the date format\n    \n* When working with spatial polygons, like administrative divisions valuate if you want to extract the values already aggregated or each cells separately\n  * for example the terrain indicators were computed for each cells and then we moved to the extraction\n  * for the climatic parameters, we extract each cells separately, we compute the parameters for each cells, and only later we aggregate them.\n\n* When georeferencing the survey location we take advantage that many interviews share the same locations. Hence, we extract the variables just for these unique locations. However, same of these unique locations may fall within the same value cells, so the actual information might be even lower.\n  \n<br><br>\n  \n## Appendix\n### New to R? Read this first!\n#### The pipe command\n\nThe pipe command `|>`. It lets you pass the result of one expression as the first argument to the next, creating a fluid chain of functions.\n\nInstead of nesting functions inside each other, you can pipe the output forward, making the code easier to read.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n4 |> log() |> exp()\n\nexp(log(4))\n```\n:::\n\n\n\n\nNote:\n\n* The base R pipe `|>` was introduced in R 4.1.0.\n\n* In some tutorials, you might also see `%>%`, which comes from the `magrittr` or `dplyr` packages. Both do a similar thing, but `|>` is now the official base R version.\n<br>\n\n#### The package namespaces\n\nThe package namespaces `package_name::function_name()`. As the name suggests, namespaces provide \"spaces\" for \"names\". They provide a context for looking up the value of an object associated with a name. When we write `terra::vect()` we are asking R to look for the function `vect()` in the `terra` package.\n\nIt's a fairly advanced topic, and by-and-large, not that important! When you first start using namespaces, it'll seem like a lot of work for little gain. However, having a high quality namespace helps encapsulate your package and makes it self-contained. This ensures that other packages won't interfere with your code, that your code won't interfere with other packages, and that your package works regardless of the environment in which it's run.\n\nYou can avoid using every time the name space by just loading the necessary packages at the beginning of the code (in the set up section for example). This is the most known and common approach. To do so just add `library(name_of_package)`, for example `library(terra)`. Then we can just call the function without the name space, like this `vect()`.\n\n<br>\n\n#### The assign operator\n\nThe assign operator `<-`. This is a peculiarity of R and it is used to assign values to variables. Note that the operators `<-` and `=` can be used, almost interchangeably.\n<br>\n\n#### Functions\nIn Stata, you're used to running do-files or programs to automate tasks. In R, functions play a similar role: they help you organize code and reuse it easily.\n\nA function in R looks like this:\n\n\n\n::: {.cell labek='fn_body'}\n\n```{.r .cell-code}\nmy_function <- function(input1, input2) {\n  # Do something with the inputs\n  result <- input1 + input2\n  return(result)\n}\n```\n:::\n\n\n\n\n* `my_function` is the function's name.\n\n* `function(input1, input2)` defines what inputs (arguments) it takes.\n\n* Inside `{}`, you write the code that runs when you call the function.\n\n* `return(result)` tells R what the output should be.\n\nYou call the function like this:\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmy_function(3, 5)\n# Output: 8\n```\n:::\n\n\n\n\nNote that you can change the order of the inputs if you properly label them.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmy_function(input2 = 5, input1 = 3)\n# Output: 8\n```\n:::\n\n\n\n\nKey points for Stata users:\n\n* Functions in R must be assigned to a name using <- (the assignment operator).\n\n* You can think of functions a little like Stata's program define, but in R, every function can return a value to be used later.\n\n* You can nest functions inside other code, making your analysis scripts cleaner and easier to read.\n\n<br><br>\n\n### Want to know about the data?\n#### Weather\nWeather observation are obtained from ERA5-Land reanalysis dataset. H-TESSEL is the land surface model that is the basis of ERA5-Land. The data is a post-processed monthly-mean average of the original ERA5-Land dataset.\n\n| Parameter           | Value                   |\n|:--------------------|:-----------------------:|\n| spatial resolution  | 0.1° x 0.1° lon lat     |\n| temporal resolution | month                   |\n| time frame          | Jan. 1950 - Dec. 2022   |\n| unit of measure     | meter or Kelvin         |\n\nIt is possible to find additional information: \n\n* [here](https://cds.climate.copernicus.eu/cdsapp#!/dataset/reanalysis-era5-land-monthly-means?tab=overview) \n* and the related manual [here](https://confluence.ecmwf.int/display/CKB/ERA5-Land). \n\nThe data can be freely download from \n\n* [here](https://cds.climate.copernicus.eu/cdsapp#!/dataset/reanalysis-era5-land-monthly-means?tab=overview).\n\n\n###### Total precipitation\nAccumulated liquid and frozen water, including rain and snow, that falls to the Earth's surface. It is the sum of large-scale precipitation and convective precipitation. Precipitation variables do not include fog, dew or the precipitation that evaporates in the atmosphere before it lands at the surface of the Earth.\n\n###### 2 metre above ground temperature\nTemperature of air at 2m above the surface of land, sea or in-land waters. 2m temperature is calculated by interpolating between the lowest model level and the Earth's surface, taking account of the atmospheric conditions.\n\n<br>\n\n#### Spatial variables \n##### Agro Ecological Zones\nThe Agro-ecological Zones classification (33 classes) provides a characterization of bio-physical resources relevant to agricultural production systems. AEZ definitions and map classes follow a rigorous methodology and an explicit set of principles. The inventory combines spatial layers of thermal and moisture regimes with broad categories of soil/terrain qualities. It also indicates locations of areas with irrigated soils and shows land with severely limiting bio-physical constraints including very cold and very dry (desert) areas as well as areas with very steep terrain or very poor soil/terrain conditions.\nThe AEZ classification dataset is part of the GAEZ v5 Land and Water Resources theme and Agro-ecological Zones sub-theme. All results are derived from the Agro-ecological Zones (AEZ) modeling framework, developed collaboratively by the Food and Agriculture Organization (FAO) and the International Institute for Applied Systems Analysis (IIASA). \n\n| Parameter           | Value                                                  |\n|:--------------------|:------------------------------------------------------:|\n| spatial resolution  | 10 km.                                                 |\n| temporal resolution | 20 years                                               |\n| time frame          | 2001–2020                                              |\n| unit of measure     | classification by climate/soil/terrain/LC (33 classes) |\n\nSuggested citation:\n\n* FAO & IIASA. 2025. Global Agro-ecological Zoning version 5 (GAEZ v5) Model Documentation. https://github.com/un-fao/gaezv5/wiki\n\n\nIt is possible to find additional information:\n\n* [here](https://github.com/un-fao/gaezv5/wiki). \n\nThe data can be freely download from:\n\n* [here](https://data.apps.fao.org/catalog/iso/2c09f61b-801c-47d2-a989-0abd3500a365).\n\n<br>\n\n##### Urban-Rural Catchment Area (URCA)\n\nUrban–rural catchment areas showing the catchment areas around cities and towns of different sizes (the no data value is 128). Each rural pixel is assigned to one defined travel time category to one of seven urban agglomeration sizes.\n\n| Parameter           | Value                                             |\n|:--------------------|:-------------------------------------------------:|\n| spatial resolution  | 0.03° x 0.03° lon lat                             |\n| temporal resolution | year                                              |\n| time frame          | 2015                                              |\n| unit of measure     | travel time category to different urban hierarchy |\n\n\nSuggested citation:\n\n* Cattaneo, Andrea; Nelson, Andy; McMenomy, Theresa (2020). Urban-rural continuum. figshare. Dataset. https://doi.org/10.6084/m9.figshare.12579572.v4\n\nIt is possible to find additional information:\n\n* [here](https://www.pnas.org/doi/full/10.1073/pnas.2011990118). \n\n\nThe data can be freely download from:\n\n* [here](https://figshare.com/articles/dataset/Urban-rural_continuum/12579572).\n\n<br>\n\n##### Population\nThe units are number of people per pixel. The mapping approach is Random Forest-based dasymetric redistribution.\n\n| Parameter           | Value                                   |\n|:--------------------|:---------------------------------------:|\n| spatial resolution  | 30 arc second (~1km)                    |\n| temporal resolution | year                                    |\n| time frame          | 2010 - 2020                             |\n| unit of measure     | estimated count of people per grid-cell |\n\nSuggested citation:\n\n*\tWorldPop (www.worldpop.org - School of Geography and Environmental Science, University of Southampton; Department of Geography and Geosciences, University of Louisville; Departement de Geographie, Universite de Namur) and Center for International Earth Science Information Network (CIESIN), Columbia University (2018). Global High Resolution Population Denominators Project - Funded by The Bill and Melinda Gates Foundation (OPP1134076). https://dx.doi.org/10.5258/SOTON/WP00647 \n\nIt is possible to find additional information from:\n\n* [here](https://www.worldpop.org/methods/top_down_constrained_vs_unconstrained/)\n* [here](https://www.worldpop.org/methods/populations/). \n\nThe data can be freely download from:\n\n* [here](https://hub.worldpop.org/geodata/summary?id=34984).\n\n<br>\n\n##### Nighttime light\n\nVIIRS nighttime lights (VNL) version V2.1: annual values obtained by from the monthly averages with filtering to remove extraneous features such as biomass burning, aurora, and background.\n\n| Parameter           | Value                       |\n|:--------------------|:---------------------------:|\n| spatial resolution  | 15 arc second               |\n| temporal resolution | year                        |\n| time frame          | 2012 - 2021                 |\n| unit of measure     | nW/cm2/sr, average-masked   |\n\nSuggested citation:\n\n* Elvidge, C.D, Zhizhin, M., Ghosh T., Hsu FC, Taneja J. Annual time series of global VIIRS nighttime lights derived from monthly averages:2012 to 2019. Remote Sensing 2021, 13(5), p.922, doi:10.3390/rs13050922\n\nIt is possible to find additional information:\n\n* [here](https://eogdata.mines.edu/products/vnl/). \n\nThe data can be freely download from:\n\n* [here](https://eogdata.mines.edu/nighttime_light/annual/v21/).\n\n<br>\n\n##### Elevation\nElevation is obtained from the auxiliary variables of GloFAS. Each pixel is the mean height elevation above sea level.\n\n| Parameter           | Value                       |\n|:--------------------|:---------------------------:|\n| spatial resolution  |\t0.03° x 0.03° lon lat       |\n| temporal resolution | 30 years                    |\n| time frame          | 1981 - 2010                 |\n| unit of measure     | Meter (m)                   |\n\n\nWeb resources:\n\n* [here](https://cds.climate.copernicus.eu/cdsapp#!/dataset/cems-glofas-forecast?tab=overview).\n* [here](https://www.globalfloods.eu/technical-information/products/)\n\nData access:\n\n* [here](https://confluence.ecmwf.int/display/CEMS/Auxiliary+Data)\n\n<br>\n\n#### Survey\n\nThe Living Standards Measurement Study - Integrated Surveys on Agriculture (LSMS-ISA) is a unique system of longitudinal surveys designed to improve the understanding of household and individual welfare, livelihoods and smallholder agriculture in Africa. The LSMS team works with national statistics offices to design and implement household surveys with a strong focus on agriculture.\n\nSuggested citation:\n\n* Central Statistics Agency of Ethiopia. (2020). Socioeconomic Survey 2018-2019 [Data set]. World Bank, Development Data Group. https://doi.org/10.48529/K739-C548\n\nIt is possible to find additional information:\n\n* [here](https://www.worldbank.org/en/programs/lsms). \n\nThe data can be freely download from:\n\n* [here](https://microdata.worldbank.org/index.php/home).\n\n<br>\n\n#### Administrative boundaries\n\nThe administrative divisions are obtained from GeoBoundaries[^2]. GeoBoundaries Built by the community and William & Mary geoLab, the geoBoundaries Global Database of Political Administrative Boundaries Database is an online, open license (CC BY 4.0) resource of information on administrative boundaries (i.e., state, county) for every country in the world. Since 2016, we have tracked approximately 1 million boundaries within over 200 entities, including all UN member states.\n\nSuggested citation:\n\n* Runfola D, Anderson A, Baier H, Crittenden M, Dowker E, Fuhrig S, et al. (2020) geoBoundaries: A global database of political administrative boundaries. PLoS ONE 15(4): e0231866. https://doi.org/10.1371/journal.pone.0231866.\n\nIt is possible to find additional information:\n\n* [here](https://www.geoboundaries.org/countryDownloads.html). \n\nThe data can be freely download from:\n\n* [here](https://www.geoboundaries.org).\n\n\n\n\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}